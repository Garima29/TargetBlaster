<!DOCTYPE html>
<html lang="eng">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width,initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">
            <title>Create Elements Javascript</title>
            <style>
                .container{
                    height: 90vh;
                    position: relative;
                    background-color: dimgray;
                    width: 90%;
                    left: 5%;
                    margin-top: 10px;
                    overflow: hidden;
                    cursor: none;
                }
                .crossHair{
                    position: absolute;
                    height: 100px;
                    width: 100px;
                    left: 10%;
                    bottom: 10%;
                    border: 1px solid black;
                    border-radius: 50px;
                    background-color: rgba(255,255,255,0.1);
                    z-index: 1000;
                }
                .crossInfo{
                    position: absolute;
                    height: 20%;
                    width: 50%;
                    margin-left: 25%;
                    background-color: black;
                    color: white;
                    font-size: 0.6em;
                    text-align: center;
                    line-height: 20px;
                    bottom: 0;
                }
                .baddy{
                    position: absolute;
                    top: 0;
                    left: 0;
                    width: 100px;
                    height: 100px;
                    padding: 5px;
                    background-color: rgba(0,0,0,0.1);
                    box-shadow: 0px 1px 8px 0px black;
                    border-radius: 50px;
                    text-align: center;
                    z-index: 2;
                }
                .btnStart{
                    display: inline-block;
                    padding: 15px;
                    border: 1px solid black;
                    background-color: red;
                    color: white;
                    font-size: 2em;
                }
                .score{
                    font-size: 4em;
                }
                .gameover{
                    position: absolute;
                    text-align: center;
                    color: white;
                    font-size: 3em;
                    line-height: 300px;
                    text-transform: uppercase;
                    width: 100%;
                }
            </style>
    </head>
    <body>
        <div class="headerInfo">
            <div class="btnStart">Start Game</div>
            Score:<span class="score">0</span>
        </div>
        <div class="container">
            <div class="gameover">Click start button</div>
            <div class="baddy"></div>
            <div class="crossHair">
                <div class="crossInfo"></div>
            </div>
        </div>
    </body>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" crossorigin="anonymous">

    </script>
    <script>
        var icons = ["bath", "bug", "coffee", "telegram", "laptop", "quora"];
        var score;
        var gameplay;
        var mDown = false;
        var BGCount;
        var hazards;
        var container = document.querySelector(".container");
        var crossHair = document.querySelector(".crossHair");
        var crossInfo = document.querySelector(".crossInfo");
        var btnStart = document.querySelector(".btnStart");
        var gameover = document.querySelector(".gameover");
        var baddy = document.querySelector(".baddy");
        var myContainer = {
            width: container.offsetWidth,
            height: container.offsetHeight,
            left: container.offsetLeft,
            top: container.offsetTop
        }
        container.addEventListener('mousedown', function(){ mDown=true}, true);
        container.addEventListener('mouseup', function(){ mDown=false }, true);
        container.addEventListener('mousemove', move, true);
        btnStart.addEventListener('click',startGame,true);
        function startGame(){
            if(!gameplay){
                BGCount=10;
                setupBadguys(6);
                score=0;
                hazards=3;
                gameplay=true;
                gameover.style.display='none';
                reqUpdate = window.requestAnimationFrame(update);
            }
        }
        function endGame(){
            gameover.style.display = 'block';
            gameover.innerHTML ='GAME OVER <br> SCORE '+score;
            gameplay = false;
            var tempEnemy = document.querySelectorAll('.baddy');
            for(var e of tempEnemy){
                e.parentNode.removeChild(e);
            }
        }
         
        function setupBadguys(num){
            for(var x=0; x<num; x++){
                badMaker();
            }
        }
        function badMaker(){
            var div = document.createElement('div');
            var randomWidth;
            var iconRan;
            if(hazards>0){
                hazards--;
                iconRan="fa-bomb";
                div.dataset.points=0;
                div.style.color='white';
                div.style.backgroundColor='black';
                div.dataset.points=0;
                randomWidth=150;
            }else{
                div.dataset.points = Math.ceil(Math.random()*10)+2;
                iconRan = "fa-"+icons[Math.floor(Math.random()*icons.length)];
                 div.style.color = randomColor();
                 randomWidth = Math.floor(Math.random()*50)+50;
            }
            var x = Math.floor(Math.random()*(myContainer.width-randomWidth));
            var y = Math.floor(Math.random()*(myContainer.height-randomWidth));
            
            div.innerHTML = '<i class= "fa '+iconRan+'"></i>';
            div.setAttribute('class', 'baddy');
            div.style.fontSize = randomWidth + 'px';
            div.style.lineHeight = randomWidth - (randomWidth*0.3) + 'px';
            div.style.height = randomWidth + 'px';
            div.style.left = x + 'px';
            div.style.top = y + 'px';
            div.dataset.dir = Math.ceil(Math.random()*4);
            div.dataset.mover = Math.ceil(Math.random()*15)+2;
            div.dataset.speed = Math.ceil(Math.random()*10)+2;
           
            container.appendChild(div);
        }
        function randomColor(){
            function c(){
                var hex = Math.floor(Math.random()*256).toString(16);
                var response = ("0"+String(hex)).substr(-2);
                return response;
            }
            return "#"+c()+c()+c();
        }
        function update(){
            if(!gameplay){
                window.cancelAnimationFrame(reqUpdate); 
            }else{
                reqUpdate=window.requestAnimationFrame(update);
                
            }
            var tempEnemy = document.querySelectorAll(".baddy");
            for(var enemy of tempEnemy){
                
                itemMover(enemy);
            }
        }
        function scoreUpdate(points){
            score+=parseInt(points);
            document.querySelector('.score').innerHTML = score;
        }

        function itemMover(e){
            var x = parseInt(e.style.left);
            var y = parseInt(e.style.top);
            var sp = parseInt(e.dataset.speed);
            if(mDown && isCollision(crossInfo, e)){
                if(e.dataset.points == 0){
                    endGame();
                    return;
                }
                    e.parentNode.removeChild(e);
                    badMaker();
                    BGCount--;
                    scoreUpdate(e.dataset.points);
                    if(BGCount < 0) {endGame();}
                    return;
                }
            if(e.dataset.mover <= 0){
                e.dataset.speed = Math.ceil(Math.random()*10)+2;
                e.dataset.dir = Math.ceil(Math.random()*4);
                e.dataset.mover = Math.ceil(Math.random()*15)+2;
            }else{
                e.dataset.mover--;
                if(e.dataset.dir == 1 && x < myContainer.width){x+=sp};
                if(e.dataset.dir == 2 && x > 0){x-=sp};
                if(e.dataset.dir == 3 && y < myContainer.height){y+=sp};
                if(e.dataset.dir == 4 && y > 0){y-=sp};
            }
            e.style.left = x + 'px';
            e.style.top = y + 'px';
        }
        function isCollision(a,b){
            var aReact = a.getBoundingClientRect();
            var bReact = b.getBoundingClientRect();
            return !(((aReact.top+aReact.height) < bReact.top) ||
            (aReact.top > (bReact.top+bReact.height)) ||
            ((aReact.left+aReact.width)<bReact.left) ||
            ((bReact.left+bReact.width) < aReact.left));
        }
        function move(e){
            crossInfo.innerHTML='X:'+(e.clientX-100)+' Y:'+(e.clientY-100);
            crossHair.style.left = (e.clientX-100) + 'px';
            crossHair.style.top = (e.clientY-100) + 'px';
        }
    </script>
</html>
